1、创建容器
docker pull nvcr.io/nvidia/pytorch:21.10-py3

docker run -dt --name yjy --restart=always --gpus all \
--network=host \
--shm-size 12G \
-v /mnt/VMSTORE/yjy/:/yjy \
-w /yjy \
nvcr.io/nvidia/pytorch:21.10-py3 \
/bin/bash


docker exec -it yjy bash

2、git fastmoe
git clone https://github.com/laekov/fastmoe.git
cd fastmoe
USE_NCCL=1 python setup.py install

pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
pip install dm-tree
pip install fairscale
pip install sentencepiece

cd MixtralKit-fast/MixtralKit-main
pip install -e .
ln -s /yjy/Mixtralkit/MixtralKit-fast/mixtral-8x7b-32kseqlen ckpts

不开策略：
torchrun --standalone --nproc_per_node=4  tools/example.py -m ./ckpts -t ckpts/tokenizer.model
报错：

开策略：
FMOE_FASTER_SCHEDULE_ENABLE=1 FMOE_FASTER_SHADOW_ENABLE=1 torchrun --standalone --nproc_per_node=4  tools/example.py -m ./ckpts -t ckpts/tokenizer.model
报错：

单机多卡：
torchrun --nproc_per_node 4 \
    --nnodes 1 \
    --node_rank 0 \
    --master_addr localhost \
    --master_port 29540 \
    tools/example.py -m ./ckpts -t ckpts/tokenizer.model

多机多卡：
torchrun --nproc_per_node 4 \
    --nnodes 2 \
    --node_rank 0 \
    --master_addr 172.20.20.140 \
    --master_port 29540 \
    tools/example.py -m ./ckpts -t ckpts/tokenizer.model

torchrun --nproc_per_node 4 \
    --nnodes 2 \
    --node_rank 1 \
    --master_addr 172.20.20.140 \
    --master_port 29540 \
    tools/example.py -m ./ckpts -t ckpts/tokenizer.model